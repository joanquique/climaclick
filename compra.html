<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Regístrate en Climaclick y disfruta de una experiencia de compra personalizada. Crea tu cuenta para acceder a ofertas exclusivas, seguimiento de pedidos y un proceso de compra más rápido y sencillo. ¡Únete a nosotros hoy mismo!">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="icon" href="img/CARRITO_AZUL_PNG-02.png" type="image/png" alt="favicon">
    <title>Compra | Climaclick</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <link rel="stylesheet" href="styles/main.css">
    <script src="js/functions.js" defer></script>
</head>
<body>
    <header> <!-- Barra de navegación -->
        <nav class="busqueda-boton">
            <ul>
                <li>
                    <form>
                        <input type="text" name="q" placeholder="Filtrar productos...">
                    </form>
                </li>
            </ul>
        </nav>
        <nav>
            <div class="menu__icon-container">
                <i class="header__icon" id="menu-toggle">
                    <img id="menu-icon" src="img/menu.svg" alt="Icono Menu" width="30">
                </i>
            </div>
            <ul class="panel-nav">
                <li class="logo-nav">
                    <a href="index.html" class="logo-link">
                        <img class="logo-morl" id="logo" src="img/CLIMACLICK_AZUL.png" alt="logo climaclick">
                    </a>
                </li>
                <li class="boton-nav"><a href="minisplit.html">Minisplit</a></li>
                <li class="boton-nav"><a href="inverter.html">Inverter</a></li>
                <li class="boton-nav"><a href="portatil.html">Portátil</a></li>
                <li class="boton-nav"><a href="vrf.html">VRF</a></li>
                <li class="boton-nav"><a href="gas_herramientas.html">Gas y Herramientas</a></li>
            </ul>  
            <div class="cart__icon-container">
                <i class="header__icon" id="cart-toggle">
                    <img id="cart-icon" src="img/shopping-cart.svg" width="30" alt="ícono carrito">
                </i>
            </div>      
        </nav>
    </header>
    <main>
        <div class="container">
            <h2>Ingresa tus datos para completar tu compra</h2>
            <p>
                <span class="campos"><span class="asterisco">*</span>Campos Obligatorios</span><br><br>
            </p>
            <br>
            <div id="paymentForm" class="registration-form">
                <div class="form-group">
                    <label for="nombre">Nombre<span class="asterisco">*</span> :</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="correo">Correo Electrónico<span class="asterisco">*</span> :</label>
                    <input type="email" id="correo" name="correo" required>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono de contacto<span class="asterisco">*</span> :</label>
                    <input type="tel" id="telefono" name="telefono" required>
                </div>
                <div class="form-group" id="address">
                    <label for="direccion">Dirección de entrega:</label><br><br>

                    <label for="calle">Calle<span class="asterisco">*</span> :</label>
                    <input type="text" id="calle" name="calle" required>

                    <label for="num_ext">Núm Ext.<span class="asterisco">*</span> :</label>
                    <input type="text" id="num_ext" name="num_ext" required>

                    <label for="num_int">Núm Int.:</label>
                    <input type="text" id="num_int" name="num_int">

                    <label for="cp">C.P.<span class="asterisco">*</span> :</label>
                    <input type="text" id="cp" name="cp" required>

                    <label for="colonia">Colonia<span class="asterisco">*</span> :</label>
                    <input type="text" id="colonia" name="colonia" required>

                    <label for="city">Municipio o alcaldía<span class="asterisco">*</span> :</label>
                    <input type="text" id="city" name="city" required>

                    <label for="state">Entidad Federativa<span class="asterisco">*</span> :</label>
                    <input type="text" id="state" name="state" required>

                    <label for="referencia">Referencia<span class="asterisco">*</span> :</label>
                    <input type="text" id="referencia" name="referencia" required>
                </div>
                <div class="terms">
                    <input type="checkbox" id="termsCheckbox" required>
                    <label for="termsCheckbox" style="font-weight: 400;">
                        Al hacer clic, aceptas los <a href="politicas.html"><b>Términos y Condiciones</b></a> y las <b>Políticas de Privacidad de Datos Personales</b></a>.
                    </label>
                </div> 
                <button class="boton-seguir-pago" id="pay-button" type="button">Proceder al pago</button>           
                <div id="wallet_container"></div>
            </div>
        </div>
        
        <section class="cart cart--container"> <!-- Carrito de compras-->
            <h2 class="cart__title">CARRITO</h2>
            <hr>
            <i id="cart-close"><img src="img/x.svg" class="cart__close-icon" alt="ícono cerrar carrito" width="25"></i> 
            <div class="cart__item-count-container">
                <span id="cart-item-count" class="cart__item-count"></span>
                <span class="cart__item-text">Artículos</span>
            </div>
            <div class="cart__total-container">
                <span class="cart__item-text">Total a pagar: $</span><b><span id="cart-total" class="cart__total"></b></span>
            </div>
            <a href="compra.html" aria-label="Proceder a informacion de compra">
                <button class="boton-comprar" id="buy-button" style="display: none;">Comprar</button>
            </a>
            <div class="cart__item"></div>
        </section>
        <section class="menu menu--container"> <!-- Menú a la izquierda (móvil)-->
            <h2 class="menu__title">MENU</h2>
            <i id="menu-close"><img src="img/x.svg" class="menu__close-icon" alt="ícono cerrar menú" width="25"></i> 
            <ul class="no-bullets">
                <a href="minisplit.html"><li class="menu-item">Minisplit</li></a>
                <a href="inverter.html"><li class="menu-item">Inverter</li></a>
                <a href="portatil.html"><li class="menu-item">Portátil</li></a>
                <a href="vrf.html"><li class="menu-item">VRF</li></a>
                <a href="gas_herramientas.html"><li class="menu-item">Gas y Herramientas</li></a>
            </ul>
        </section>
        <script>
            async function initializeMP() {
                try {
                    // Obtener la clave pública del servidor
                    const response = await fetch("http://localhost:3000/get_public_key");
                    const data = await response.json();
                    const publicKey = data.publicKey;
        
                    // Inicializar MercadoPago con la clave pública obtenida
                    const mp = new MercadoPago(publicKey, {
                        locale: "es-MX",
                    });
                    const bricksBuilder = mp.bricks();
        
                    document.getElementById('pay-button').addEventListener('click', async () => {
                        
                        const quantity = document.querySelector("span.cart__item-count").innerText;
                        const name = document.querySelector("div.cart__item").innerText;
                        const total = document.querySelector("span.cart__total").innerText;
                        const formattedTotal = parseFloat(total.replace(/,/g, '').replace('.', ''));
                        const result = (formattedTotal / 100).toFixed(2);
        
                        try {
                            const orderData = {
                                title: name,
                                quantity: quantity,
                                price: result / quantity,
                            };
                        
                            const response = await fetch("http://localhost:3000/create_preference", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify(orderData),
                            });
                        
                            const preference = await response.json()
                            createCheckoutButton(preference.id);
                        
                        } catch (error) {
                            alert("error: :(");
                        }
                    });
        
                    const createCheckoutButton = (preferenceId) => {
                        const bricksBuilder = mp.bricks();
        
                        const renderComponent = async () => {
                            if(window.checkoutButton) window.checkoutButton.unmount();
                            await bricksBuilder.create("wallet", "wallet_container", {
                                initialization: {
                                    preferenceId: preferenceId,
                                },
                            });
                        }
                        renderComponent();
                    };
        
                } catch (error) {
                    console.error("Error al obtener la clave pública:", error);
                }
            }
        
            // Llamar a la función para inicializar MercadoPago
            initializeMP();
        </script>
        
    </main>
    <hr>
    <footer>
        <div class="footer-logo">
            <a href="index.html"><img src="img/CLIMACLICK_AZUL.png" alt="Logo Climaclick"></a>
        </div>
        <div class="footer-content">
            <div class="footer-column">
                <h3>Categorías</h3>
                <ul>
                    <li><a href="minisplit.html">Minisplit</a></li>
                    <li><a href="inverter.html">Inverter</a></li>
                    <li><a href="portatil.html">Portátil</a></li>
                    <li><a href="vrf.html">VRF</a></li>
                    <li><a href="gas_herramientas.html">Gas y Herramientas</a></li>
                    <li><a href="productos.html">Productos</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="politicas.html">Políticas</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Contacto</h3>
                <p class="address">
                    <a href="https://www.google.com.mx/maps/place/climaclick/@19.4686753,-99.1361966,17z/data=!3m1!4b1!4m6!3m5!1s0x85d1f9dad5fb51b5:0x7862b831f3e1d71!8m2!3d19.4686753!4d-99.1336217!16s%2Fg%2F11y655p118?entry=ttu" target="_blank">
                        Schumann 202 Gustavo A. Madero, CDMX
                    </a>
                </p>
                <p class="contact">
                    <img class="icon" src="img/phone-call.svg" alt="ícono teléfono">
                    <a class="mail" href="tel:525590206366"> (55) 9020-6366 </a> | Lun - Vie (9 am - 6 pm)
                </p>
                <p class="contact">
                    <img class="icon" src="img/mail.svg" alt="ícono correo">
                    <a class="mail" href="mailto:ventas@climaclick.com.mx">ventas@climaclick.com.mx</a>
                </p>
                <div class="social-icons">
                    <a href="https://www.facebook.com/climaclick.com.mx" target="_blank"><img src="img/facebook.svg" alt="ícono Facebook" class="social-icon"></a>
                    <a href="https://www.instagram.com/climaclick.com.mx" target="_blank"><img src="img/instagram.svg" alt="ícono Instagram" class="social-icon"></a>
                </div>
            </div>
        </div>
        <p class="copyright">&copy; 2024 Climaclick</p>
    </footer>
</body>
</html>